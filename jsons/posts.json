[{"id":1641913200,"title":"React와 Recoil을 사용해 튜토리얼을 만들어보자","author":"jangky000","date":"2022.01.12","content":"\n# 기획 내용\n\n- 전달 받은 튜토리얼 내용\n    - 특이 사항: 포커스가 변하지 않아도, 팝오버 설명 텍스트가 변할 수 있다. (포커스 개수  ≤ 튜토리얼 개수)\n    \n    ![1](https://user-images.githubusercontent.com/46799722/149144274-e7ecc1f0-786d-45bd-9ea9-d8c7151090fe.png)\n    \n\n- 첫 화면\n    \n    ![2](https://user-images.githubusercontent.com/46799722/149144272-f16aa2de-6095-4397-981d-63c9100d245c.png)\n    \n\n- 다음 버튼을 누르면 설명에 해당하는 부분으로 스크롤 이동하며 포커싱\n    \n    ![3](https://user-images.githubusercontent.com/46799722/149144263-e3b5c3ee-d8dc-4b18-a040-6fa3171ae81a.png)\n    \n    ![4](https://user-images.githubusercontent.com/46799722/149144251-71981a02-f214-45d6-a979-ee91feb5e2a9.png)\n    \n\n- 접기 > PopOver를 접고 FAB 사이즈가 줄어듦\n    \n    ![5](https://user-images.githubusercontent.com/46799722/149144269-fbda31a6-4741-4ef9-8fcd-234edb27bc31.png)\n    \n\n# 전역 상태 관리\n\n- atom & selector\n    \n    ```tsx\n    import { atom, selector } from 'recoil';\n    import { tutorialHelperText } from '@/components/Demo/TutorialHelper/TutorialHelper.data';\n    import { TutorialNode } from '@/components/Demo/TutorialHelper/TutorialNode';\n    import { TutorialMenu } from '@/components/Demo/TutorialHelper/TutorialHelper.interface';\n    \n    interface DemoTutorialState {\n      isDemo: boolean;\n      isExpired: boolean;\n      isEmailVerified: boolean;\n      isFolded: boolean;\n      tutorialNode: TutorialNode | null;\n    }\n    \n    const isDemo = JSON.parse(sessionStorage.getItem('isDemo') || 'false') as boolean;\n    \n    export const demoTutorialState = atom<DemoTutorialState>({\n      key: 'demoGuideState',\n      default: {\n        isDemo,\n        isExpired: false,\n        isEmailVerified: false,\n        isFolded: false,\n        tutorialNode: null,\n      },\n    });\n    \n    interface TutorialHelperState {\n      menu: TutorialMenu | null;\n      title: string | null;\n      subTitle: string | null;\n      desc: string | null;\n      tutorialStep: number;\n      totalStep: number;\n      prev: TutorialNode | null;\n      next: TutorialNode | null;\n    }\n    \n    export const demoTutorialStateSelector = selector({\n      key: 'demoGuideStateSelector',\n      get: ({ get }) => {\n        const { tutorialNode } = get(demoTutorialState);\n    \n        if (tutorialNode === null)\n          return {\n            menu: null,\n            title: null,\n            subTitle: null,\n            desc: null,\n            tutorialStep: 0,\n            totalStep: 0,\n            prev: null,\n            next: null,\n          };\n    \n        const {\n          info: { menu, tutorialStep },\n          prev,\n          next,\n        } = tutorialNode;\n        const { title, step } = tutorialHelperText[menu];\n        const { subTitle, desc } = step[tutorialStep];\n        const totalStep = tutorialHelperText[menu].step.length;\n        const derivedState = {\n          menu,\n          title,\n          subTitle: subTitle || null,\n          desc,\n          tutorialStep,\n          totalStep,\n          prev,\n          next,\n        };\n        return derivedState as TutorialHelperState;\n      },\n    });\n    ```\n    \n- 튜토리얼 내용 관리\n    - 양방향 연결 리스트로 튜토리얼의 내용 연결 순서 관리\n    - 튜토리얼 안내 문구 관리\n    \n    ```tsx\n    import { TutorialLinkedList } from './TutorialLinkedList';\n    import { TutorialHelperText } from './TutorialHelper.interface';\n    \n    /**\n     * @description 튜토리얼 안내 문구\n     */\n    export const tutorialHelperText: TutorialHelperText = {\n      Automation: {\n        title: '자동화',\n        step: [\n          {\n            desc:\n              '내 사이트의 퍼널, 판매 현황을 파악하고 각 퍼널 단계별로 고객그룹을 분류하여 캠페인을 빠르게 진행할 수 있습니다.',\n          },\n          {\n            subTitle: '퍼널 현황',\n            desc:\n              '방문부터 결제까지 각 퍼널 단계별 전환과 이탈 수치를 확인하고, 이탈고객을 붙잡기 위한 추천 캠페인을 진행할 수 있습니다.',\n          },\n          {\n            subTitle: '퍼널 현황-주요관리필요구간',\n            desc: '이탈 수치가 가장 높은 퍼널의 고객을 확인하거나 추천 캠페인을 바로 진행할 수 있습니다.',\n          },\n          {\n            subTitle: '캠페인 성과',\n            desc: '빅인을 통해 진행한 캠페인 성과를 유형별로 요약하여 확인할 수 있습니다.',\n          },\n          {\n            subTitle: '구매 현황',\n            desc: '사이트의 구매 전환 분석 데이터와 상품 정보를 확인할 수 있습니다.',\n          },\n        ],\n      },\n      CampaignList: {\n        title: '캠페인',\n        step: [\n          {\n            desc: '고객 행동 데이터 기반으로 타겟팅 하여 사이트 내에서 또는 메신저를 통해 자동화 캠페인을 할 수 있습니다.',\n          },\n          {\n            subTitle: '캠페인 시작하기 버튼 - 캠페인 종류 선택 레이어',\n            desc: '팝업, 토스트를 활용해 웹 사이트 내에서 온사이트 캠페인을 할 수 있습니다.',\n          },\n          {\n            subTitle: '캠페인 시작하기 버튼 - 캠페인 종류 선택 레이어',\n            desc: '카카오 친구톡/알림톡, SMS 를 활용 해 오프사이트 캠페인을 할 수 있습니다.',\n          },\n          {\n            subTitle: '캠페인 리스트',\n            desc: '캠페인들의 진행 상황을 관리할 수 있습니다.',\n          },\n        ],\n      },\n      SegmentSmartList: {\n        title: '스마트 그룹',\n        step: [\n          {\n            desc:\n              '방문, 구매이력 등의 수집 데이터를 통해 빅인의 알고리즘으로 분석한 고객 세그먼트 입니다. SDK 를 설치하면 2주 뒤에 활성화 됩니다.',\n          },\n          {\n            subTitle: '스마트그룹 리스트',\n            desc:\n              '리스트의 고객 그룹을 선택하면 해당하는 고객 리스트를 확인할 수 있습니다. 다만, 데이터가 충분하지 않으면 해당 세그먼트에 고객 리스트가 없을 수 있습니다.',\n          },\n        ],\n      },\n      SegmentManualList: {\n        title: '고객 분류',\n        step: [\n          {\n            desc: 'CRM, 마케팅 목적에 맞는 고객 그룹을 직접 만들어 캠페인에 활용할 수 있습니다.',\n          },\n          {\n            subTitle: '기본',\n            desc:\n              '마케터들이 많이 궁금해하는 고객 목록이 기본으로 제공 됩니다. 별도의 조건 설정 없이 빠르게 고객목록을 확인하고 캠페인을 진행할 수 있습니다.',\n          },\n          {\n            subTitle: '맞춤',\n            desc: '빅인 사용자가 직접 조건을 설정해 생성한 고객 그룹 입니다.',\n          },\n          {\n            subTitle: '새 고객 그룹 생성',\n            desc: '맞춤 고객 그룹을 생성하는 화면으로 이동할 수 있습니다.',\n          },\n        ],\n      },\n      ReportList: {\n        title: '보고서',\n        step: [\n          {\n            desc:\n              '빅인 SDK 로 수집한 데이터를 사용자가 원하는 형태로 보고서를 만들고, 고객의 행동 정보를 확인할 수 있습니다.',\n          },\n          {\n            subTitle: '보고서 만들기 - 이벤트',\n            desc: '이벤트 보고서를 통해 마케터가 직접 분석하고자 하는 조건을 설정하여 보고서를 만들 수 있습니다.',\n          },\n          {\n            subTitle: '보고서 만들기 - 라이브',\n            desc: '사이트에서 발생하는 이벤트를 실시간으로 확인할 수 있습니다.',\n          },\n          {\n            subTitle: '보고서 만들기 - 고객 탐색',\n            desc: '사용자가 생성한 고객 그룹에 해당하는 고객 목록을 확인 할 수 있습니다.',\n          },\n        ],\n      },\n    };\n    \n    /**\n     * @description 튜토리얼 순서 설정 연결 리스트 생성\n     */\n    export const TutorialAutomationList = new TutorialLinkedList();\n    tutorialHelperText.Automation.step.forEach((_, index) =>\n      TutorialAutomationList.add({ menu: 'Automation', tutorialStep: index }),\n    );\n    export const TutorialCampaignList = new TutorialLinkedList();\n    tutorialHelperText.CampaignList.step.forEach((_, index) =>\n      TutorialCampaignList.add({ menu: 'CampaignList', tutorialStep: index }),\n    );\n    export const TutorialSegmentSmartList = new TutorialLinkedList();\n    tutorialHelperText.SegmentSmartList.step.forEach((_, index) =>\n      TutorialSegmentSmartList.add({ menu: 'SegmentSmartList', tutorialStep: index }),\n    );\n    export const TutorialSegmentManualList = new TutorialLinkedList();\n    tutorialHelperText.SegmentManualList.step.forEach((_, index) =>\n      TutorialSegmentManualList.add({ menu: 'SegmentManualList', tutorialStep: index }),\n    );\n    export const TutorialReportList = new TutorialLinkedList();\n    tutorialHelperText.ReportList.step.forEach((_, index) =>\n      TutorialReportList.add({ menu: 'ReportList', tutorialStep: index }),\n    );\n    ```\n    \n    - 인터페이스, 노드, 연결리스트 보기\n        \n        ```tsx\n        // TutorialHelper.interface.ts\n        \n        export type TutorialMenu = 'Automation' | 'CampaignList' | 'SegmentSmartList' | 'SegmentManualList' | 'ReportList';\n        \n        export type TutorialHelperText = {\n          [key in TutorialMenu]: {\n            title: string;\n            step: Array<{\n              subTitle?: string;\n              desc: string;\n            }>;\n          };\n        };\n        \n        export interface TutorialInfo {\n          menu: TutorialMenu;\n          tutorialStep: number;\n        }\n        ```\n        \n        ```tsx\n        // TutorialNode.ts\n        \n        import { TutorialInfo } from './TutorialHelper.interface';\n        \n        export class TutorialNode {\n          info: TutorialInfo;\n        \n          prev: TutorialNode | null;\n        \n          next: TutorialNode | null;\n        \n          constructor(info: TutorialInfo) {\n            this.info = info;\n            this.prev = null;\n            this.next = null;\n          }\n        }\n        ```\n        \n        ```tsx\n        // TutorialLinkedList.ts\n        \n        import { TutorialInfo } from './TutorialHelper.interface';\n        import { TutorialNode } from './TutorialNode';\n        \n        export class TutorialLinkedList {\n          public head: TutorialNode | null = null;\n        \n          tail: TutorialNode | null = null;\n        \n          constructor(headInfo?: TutorialInfo) {\n            if (headInfo) this.init(headInfo);\n          }\n        \n          init(headInfo: TutorialInfo): void {\n            this.head = new TutorialNode(headInfo);\n            this.tail = this.head;\n          }\n        \n          add(newInfo: TutorialInfo): void {\n            if (this.tail === null) this.init(newInfo);\n            else {\n              const newNode = new TutorialNode(newInfo);\n              newNode.prev = this.tail;\n              this.tail.next = newNode;\n              this.tail = newNode;\n            }\n          }\n        }\n        ```\n        \n\n# 포커스 컴포넌트\n\n- 포커스\n    \n    ```tsx\n    import React, { FC, useMemo, useEffect, useRef } from 'react';\n    import { useRecoilValue } from 'recoil';\n    import { isEqual } from 'lodash';\n    import { demoTutorialState } from '../../../recoil/DemoTutorialState';\n    import { TutorialMenu } from '../TutorialHelper/TutorialHelper.interface';\n    import { StyledLayout } from './TutorialFocus.style';\n    \n    export interface FocusTarget {\n      menu: TutorialMenu;\n      tutorialStep: number;\n    }\n    \n    const isMatch = (propTarget: FocusTarget | FocusTarget[], recoilInfo: FocusTarget) => {\n      if (Array.isArray(propTarget)) return propTarget.some((target) => isEqual(target, recoilInfo));\n      return isEqual(propTarget, recoilInfo);\n    };\n    export interface TutorialFocusProps {\n      focusTarget: FocusTarget | FocusTarget[];\n      style?: React.CSSProperties;\n      children: React.ReactNode;\n    }\n    export const TutorialFocus: FC<TutorialFocusProps> = ({ focusTarget, style, children }: TutorialFocusProps) => {\n      const ref = useRef<HTMLDivElement>(null);\n      const { tutorialNode, isFolded } = useRecoilValue(demoTutorialState);\n    \n      const isFocusOn = useMemo(() => {\n        if (isFolded) return false;\n        if (tutorialNode === null) return false;\n        const { info } = tutorialNode;\n        return isMatch(focusTarget, info);\n      }, [isFolded, tutorialNode]);\n    \n      useEffect(() => {\n        if (isFocusOn) ref.current?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n      }, [isFocusOn]);\n    \n      return (\n        <StyledLayout isFocusOn={isFocusOn} style={style} ref={ref}>\n          {isFocusOn && <span className=\"dot\" />}\n          {children}\n        </StyledLayout>\n      );\n    };\n    ```\n    \n    - 스타일\n        \n        ```tsx\n        // TutorialFocus.style.tsx\n        \n        import { keyframes } from '@emotion/react';\n        import styled from '@emotion/styled';\n        \n        const pulse = keyframes`\n          0% {\n            transform: scale(1);\n          }\n        \n          70% {\n            opacity: 0;\n          }\n        \n          100% {\n            transform: scale(2);\n            opacity: 0;\n          }\n        `;\n        \n        export const StyledLayout = styled.div<{ isFocusOn: boolean }>`\n          label: tutorial-focus-layout;\n        \n          ${({ isFocusOn, theme }) =>\n            isFocusOn &&\n            `\n          border-radius: 8px;\n          border: solid 1px ${theme.colors.primary};\n          position: relative;\n          `}\n          \n          .dot {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 12px;\n            height: 12px;\n            background-color: ${({ theme }) => theme.colors.primary};\n            border-radius: 50%;\n            transform: translate(-50%, -50%);\n            z-index: 1;\n        \n            :before {\n              content: '';\n              position: absolute;\n              left: 0;\n              right: 0;\n              top: 0;\n              bottom: 0;\n              background-color: ${({ theme }) => theme.colors.primary};\n              border-radius: 50%;\n              animation: ${pulse} 1.25s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;\n            }\n        `;\n        ```\n        \n\n# 튜토리얼 FAB 컴포넌트\n\n- Tutorial FAB & PopOver\n    \n    ```tsx\n    // TutorialHelper.tsx\n    ...\n    import { useRecoilValue, useSetRecoilState } from 'recoil';\n    import { demoTutorialState, demoTutorialStateSelector } from '../../../recoil/DemoTutorialState';\n    ...\n    \n    export const TutorialHelper: FC = () => {\n      const i18next = useTranslation();\n    \n      const { title, subTitle, desc, prev, next } = useRecoilValue(demoTutorialStateSelector);\n      const { isDemo, isFolded } = useRecoilValue(demoTutorialState);\n      const setDemoTutorial = useSetRecoilState(demoTutorialState);\n    \n      const openPopOver = () => setDemoTutorial((curVal) => ({ ...curVal, isFolded: false }));\n      const closePopOver = () => setDemoTutorial((curVal) => ({ ...curVal, isFolded: true }));\n    \n      const toPrevTutorial = () => {\n        if (prev !== null) setDemoTutorial((currVal) => ({ ...currVal, tutorialNode: prev }));\n      };\n      const toNextTutorial = () => {\n        if (next !== null) setDemoTutorial((currVal) => ({ ...currVal, tutorialNode: next }));\n      };\n    \n      const List: FC<{ href: string; children: React.ReactNode }> = ({\n        href,\n        children,\n      }: {\n        href: string;\n        children: React.ReactNode;\n      }) => {\n        return (\n          <React.Fragment>\n            <StyledList\n              onClick={() => {\n                window.open(href, '_blank');\n              }}\n            >\n              <div className=\"children\">{children}</div>\n              <FontIcon name=\"ic-arrow-right\" size=\"16px\" />\n            </StyledList>\n          </React.Fragment>\n        );\n      };\n      return isDemo && title && desc ? (\n        <StyledLayout>\n          {!isFolded && (\n            <React.Fragment>\n              <StyledUpperPopOver>\n                <div className=\"title\">{i18next.t('바로가기')}</div>\n    \n                <ul className=\"menu-list\">\n                  <List href=\"https://bigin.io/contact\">\n                    <span role=\"img\" aria-label=\"\">\n                      💌\n                    </span>\n                    <span>{i18next.t('상담 신청하기')}</span>\n                  </List>\n    \n                  <List href=\"https://docs.google.com/forms/d/e/1FAIpQLScH1ZlWpgqPtcTS0RWHxGxOsUO_4cCYiBFdgxfh6SWEIZgEBA/viewform\">\n                    <span role=\"img\" aria-label=\"\">\n                      👩‍💻\n                    </span>\n                    <span>{i18next.t('비대면 오리엔테이션 듣기')}</span>\n                    <BGTooltip\n                      title={\n                        i18next.t(\n                          'bigin 오리엔테이션은 bigin을 통해 활용할 수 있는 데이터 항목, 데이터를 기반으로 고객을 분류하는 세 가지 방법, CRM 마케팅 활용 사례를 공유하고 간략한 bigin 대시보드 시연합니다.',\n                        ) || ''\n                      }\n                    >\n                      <div className=\"tip\">\n                        <FontIcon name=\"ic-info\" size=\"16px\" />\n                      </div>\n                    </BGTooltip>\n                  </List>\n                </ul>\n              </StyledUpperPopOver>\n    \n              {title && desc && (\n                <StyledPopOver>\n                  <div className=\"border-box\">\n                    <div className=\"title\">{subTitle ? `${title}: ${subTitle}` : title}</div>\n                    <div className=\"desc\">{desc}</div>\n                  </div>\n    \n                  <div className=\"bottom\">\n                    <button type=\"button\" className=\"close\" onClick={closePopOver}>\n                      접기\n                    </button>\n    \n                    <BGButtonGroup>\n                      {prev !== null && (\n                        <BGButton appearance=\"secondary\" onClick={toPrevTutorial}>\n                          <FontIcon name=\"ic-arrow-left\" size=\"20px\" />\n                        </BGButton>\n                      )}\n    \n                      {next !== null && (\n                        <BGButton onClick={toNextTutorial}>\n                          <FontIcon name=\"ic-arrow-right\" size=\"20px\" />\n                        </BGButton>\n                      )}\n                    </BGButtonGroup>\n                  </div>\n                </StyledPopOver>\n              )}\n            </React.Fragment>\n          )}\n    \n          {/* button */}\n          <StyledFAB type=\"button\" active={!isFolded} onClick={isFolded ? openPopOver : closePopOver}>\n            <img\n              src={isFolded ? '/assets/img/demo/logo-symbol-white.svg' : '/assets/img/demo/img-tutorial-helper.svg'}\n              alt=\"tutorial helper\"\n            />\n          </StyledFAB>\n        </StyledLayout>\n      ) : (\n        <React.Fragment />\n      );\n    };\n    ```\n    \n    - 스타일\n        \n        ```tsx\n        // TutorialHelper.style.tsx\n        \n        import { keyframes, css } from '@emotion/react';\n        import styled from '@emotion/styled';\n        \n        const borderRadiusBig = 12;\n        const borderRadiusSmall = 8;\n        \n        const pulse = keyframes`\n          0% {\n            transform: scale(1);\n          }\n        \n          70% {\n            opacity: 0;\n          }\n        \n          100% {\n            transform: scale(1.2);\n            opacity: 0;\n          }\n        `;\n        \n        export const StyledLayout = styled.div`\n          label: tutorial-helper-layout;\n        \n          box-sizing: border-box;\n        \n          position: fixed;\n          right: 30px;\n          bottom: 30px;\n          z-index: 99;\n          display: flex;\n          flex-direction: column;\n          align-items: flex-end;\n        `;\n        \n        export const StyledUpperPopOver = styled.div`\n          label: tutorial-helper-upper-pop-over;\n        \n          box-sizing: border-box;\n        \n          width: 320px;\n          padding: 9px 12px;\n          border-radius: ${borderRadiusBig}px;\n          background-color: #000a29;\n        \n          .title {\n            font-size: 14px;\n            font-weight: bold;\n            line-height: 1.43;\n            color: #e3e5eb;\n            margin-bottom: 8px;\n          }\n        \n          .menu-list {\n            list-style: none;\n            margin: 0;\n            padding: 0;\n          }\n        `;\n        \n        export const StyledList = styled.li`\n          label: upper-pop-over-list;\n        \n          box-sizing: border-box;\n          list-style: none;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 6px 10px;\n          border-radius: ${borderRadiusSmall}px;\n          border: solid 1px #2b4289;\n          font-size: 14px;\n          font-weight: normal;\n          line-height: 1.71;\n          color: #e4e4e4;\n        \n          :hover {\n            cursor: pointer;\n          }\n        \n          :not(:last-child) {\n            margin-bottom: 8px;\n          }\n        \n          .children {\n            display: flex;\n        \n            span[role='img'] {\n              margin-right: 10px;\n            }\n        \n            .tip {\n              margin-left: 3px;\n              display: flex;\n              align-items: center;\n            }\n          }\n        `;\n        \n        export const StyledPopOver = styled.div`\n          label: tutorial-helper-pop-over;\n        \n          box-sizing: border-box;\n        \n          width: 320px;\n          margin-top: 5px;\n          padding: 8px 8px 12px;\n          border-radius: ${borderRadiusBig}px;\n          background-color: #000a29;\n          position: relative;\n        \n          :before {\n            content: '';\n            position: absolute;\n            right: 40px;\n            bottom: -16px;\n            width: 0;\n            height: 0;\n            border-top: 16px solid black;\n            border-left: 16px solid transparent;\n          }\n        \n          .border-box {\n            border-radius: ${borderRadiusSmall}px;\n            border: solid 1px #2b4289;\n            padding: 12px;\n            margin-bottom: 18px;\n        \n            .title {\n              font-size: 16px;\n              font-weight: bold;\n              line-height: 1.5;\n              color: #fff;\n              margin-bottom: 12px;\n            }\n        \n            .desc {\n              font-size: 14px;\n              font-weight: normal;\n              line-height: 1.71;\n              color: #d8d8d8;\n            }\n          }\n        \n          .bottom {\n            display: flex;\n            justify-content: space-between;\n        \n            .close {\n              border: 0;\n              outline: 0;\n              background-color: transparent;\n              font-size: 16px;\n              font-weight: normal;\n              line-height: normal;\n              color: #abb3c2;\n        \n              :hover {\n                cursor: pointer;\n                font-weight: bold;\n                text-decoration: underline;\n              }\n            }\n        \n            .bg-button {\n              padding: 8px;\n            }\n          }\n        `;\n        \n        export const StyledFAB = styled.button<{ active?: boolean }>`\n          label: tutorial-helper-fab;\n        \n          all: unset;\n        \n          display: flex;\n          justify-content: center;\n          align-items: center;\n          position: relative;\n          transition: width 1s ease, height 1s ease;\n        \n          :hover {\n            cursor: pointer;\n          }\n        \n          ${({ active, theme }) => {\n            if (active)\n              return css`\n                background-color: ${theme.colors.primary};\n                margin-top: 30px;\n                border-radius: ${borderRadiusBig}px;\n                width: 80px;\n                height: 80px;\n        \n                &:before {\n                  content: '';\n                  position: absolute;\n                  left: 0;\n                  top: 0;\n                  right: 0;\n                  bottom: 0;\n                  border-radius: ${borderRadiusBig}px;\n                  transform: scale(1);\n                  border: 1px solid ${theme.colors.primary};\n                  animation: ${pulse} 1.25s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;\n                }\n        \n                &:after {\n                  content: '';\n                  position: absolute;\n                  left: 0;\n                  top: 0;\n                  right: 0;\n                  bottom: 0;\n                  border-radius: ${borderRadiusBig}px;\n                  transform: scale(1);\n                  border: 1px solid ${theme.colors.primary};\n                  animation: ${pulse} 1.25s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;\n                  animation-delay: 0.2s;\n                }\n        \n                img {\n                  width: 100%;\n                  height: auto;\n                }\n              `;\n        \n            return css`\n              background-color: #000a29;\n              width: 48px;\n              height: 48px;\n              border-radius: ${borderRadiusSmall}px;\n        \n              img {\n                width: 45%;\n                height: auto;\n              }\n            `;\n          }}\n        `;\n        ```\n        \n\n# 사용\n\n- /demo 라우터로 들어왔을 때, 데모 계정으로 로그인 한 후 isDemo 업데이트\n    \n    ```tsx\n    \n    demoLoginPromise.then((res)=>{\n    \t...\n    \tsetDemoTutorial((prev) => ({ ...prev, isDemo: true }));\n    \t...\n    })\n    ```\n    \n- 튜토리얼 FAB + 팝오버\n    \n    ```tsx\n    // 최상단 컴포넌트에 추가\n    <TutorialHelper />\n    ```\n    \n- 페이지 시작 부분에서 초기화\n\n```tsx\n// /pages/Automation.tsx\n\nimport { useRecoilValue, useSetRecoilState } from 'recoil';\nimport { demoTutorialState } from '@/recoil/DemoTutorialState';\nimport { TutorialAutomationList } from '@/components/Demo/TutorialHelper/TutorialHelper.data';\n\nexport const Automation = (): ReactElement => {\n\t...\n  const { isDemo } = useRecoilValue(demoTutorialState);\n  const setDemoTutorial = useSetRecoilState(demoTutorialState);\n\n\t...\n\n  useEffect(() => {\n    if (isDemo) setDemoTutorial((curVal) => ({ ...curVal, tutorialNode: TutorialAutomationList.head }));\n    return () => {\n      if (isDemo) setDemoTutorial((curVal) => ({ ...curVal, tutorialNode: null }));\n    };\n  }, [isDemo]);\n\n\t...\n\n  return (\n    <BGPage className=\"container-section\" direction=\"column\" css={[baseCss]}>\n      ...\n    </BGPage>\n  );\n};\n```\n\n- 포커스 설정\n    - demoTutorialState의 menu가 “Automation”이고 focusStep이 1이면 포커싱이 활성화된다.\n\n```tsx\n<TutorialFocus focusTarget={{ menu: 'Automation', tutorialStep: 3 }}>\n  <BorderSection>\n    ...\n  </BorderSection> \n</TutorialFocus>\n```\n\n```tsx\n<TutorialFocus\n  focusTarget={[\n    { menu: 'Automation', tutorialStep: 3 },\n    { menu: 'CampaignList', tutorialStep: 2 },\n  ]}\n>\n  <BorderSection>\n    ...\n  </BorderSection>\n</TutorialFocus>\n```"},{"id":1636038000,"title":"평점 분석을 위한 Python 라이브러리 기초 문법을 배워보자","author":"jangky000","date":"2021.11.05","content":"\n# 사용 라이브러리\n\n````python\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport math\n````\n\n# CSV 불러오기\n\n````python\ndf = pd.read_csv('movielens/ratings.csv')\n````\n\n\n# DataFrame의 shape, columns 확인\n````python\nprint(df.shape)\nprint(df.columns)\n````\n\n````\nresult: \n\n(100004, 4)\nIndex(['userId', 'movieId', 'rating', 'timestamp'], dtype='object')\n````\n\n# iloc\n- integer-location based indexing\n- 행 선택\n\n````python\ndf[['userId', 'movieId', 'rating']].iloc[10:15]\n````\n\n````\nresult: \n\n\tuserId\tmovieId\trating\n10\t1\t1371\t2.5\n11\t1\t1405\t1.0\n12\t1\t1953\t4.0\n13\t1\t2105\t4.0\n14\t1\t2150\t3.0\n````\n\n# timestamp를 '2009-12-14 02:52:24' 형태로 출력\n\n````python\npd.to_datetime(df['timestamp'].astype(int), unit='s')\n````\n\n````\nresult: \n\n0        2009-12-14 02:52:24\n1        2009-12-14 02:52:59\n2        2009-12-14 02:53:02\n3        2009-12-14 02:53:05\n4        2009-12-14 02:53:25\n                 ...        \n````\n\n# 'year' 칼럼 추가\n\n````python\ndf['date'] = pd.to_datetime(df['timestamp'].astype(int), unit='s')\ndf['year'] = df['date'].apply(lambda x: x.year)\ndf\n````\n\n````\nresult: \n\n        userId  movieId  rating   timestamp                date  year\n0            1       31     2.5  1260759144 2009-12-14 02:52:24  2009\n1            1     1029     3.0  1260759179 2009-12-14 02:52:59  2009\n2            1     1061     3.0  1260759182 2009-12-14 02:53:02  2009\n3            1     1129     2.0  1260759185 2009-12-14 02:53:05  2009\n4            1     1172     4.0  1260759205 2009-12-14 02:53:25  2009\n...        ...      ...     ...         ...                 ...   ...\n````\n\n# 그룹별 Count\n- group by(), size()\n\n````python\nyearCounts = df.groupby('year').size()\nprint(type(yearCounts))\nyearCounts\n````\n\n````\nresult: \n\n<class 'pandas.core.series.Series'>\nyear\n1995        3\n1996     6239\n1997     3294\n1998     1825\n1999     5901\n2000    13869\n2001     4658\n2002     3938\n...\n````\n\n# 바 차트 그리기\n\n````python\nyearCounts = pd.DataFrame(data = yearCounts, columns = ['counts']) # DataFrame\nyearCounts.plot(kind='bar', figsize=(12, 8), label='counts', legend=True)\n````\n\n````\nresult: \n````\n<img src=\"https://user-images.githubusercontent.com/46799722/140495795-36473127-33d3-488c-afcc-16d3570d05f5.png\" style=\"width: 100%;\"/>\n\n# Train Data 추출\n- frac: 추출할 표본 비율\n- random_state: 난수 발생 초기값, 재현 가능성을 위해 필요, seed for random number generator\n\n````python\ntrain = df.sample(frac=0.9, random_state=1)\ntrain['type'] = 'train'\ntrain.head()\n````\n\n````\nresult: \n\n       userId  movieId  rating   timestamp                date  year   type\n99778     667      446     4.0   847271818 1996-11-06 09:16:58  1996  train\n16170     104    71135     3.5  1446674062 2015-11-04 21:54:22  2015  train\n3521       19     1394     5.0   855192061 1997-02-06 01:21:01  1997  train\n55070     395      671     5.0   953007109 2000-03-14 04:11:49  2000  train\n25477     187      953     3.0  1230361942 2008-12-27 07:12:22  2008  train\n````\n\n# Test Data 추출\n\n````python\ntest = df.drop(train.index)\ntest['type'] = 'test'\ntest.head()\n````\n\n````\nresult: \n\n    userId  movieId  rating   timestamp                date  year  type\n9        1     1343     2.0  1260759131 2009-12-14 02:52:11  2009  test\n15       1     2193     2.0  1260759198 2009-12-14 02:53:18  2009  test\n18       1     2968     1.0  1260759200 2009-12-14 02:53:20  2009  test\n27       2      110     4.0   835355532 1996-06-21 11:12:12  1996  test\n47       2      273     4.0   835355779 1996-06-21 11:16:19  1996  test\n````\n\n---\n\n# 영화 전체의 평균 평점으로 각각의 영화 평점 예측\n\n## Train Data의 평점 평균을 계산\n\n````python\navgRating = train['rating'].mean()\navgRating\n````\n\n````\nresult: \n\n3.5421147948980045\n````\n\n## Test 데이터의 'pred' 칼럼에 Train Data의 평점 평균을 모두 추가\n\n````python\navgPred = test[['userId', 'movieId', 'rating']].copy()\navgPred['pred'] = avgRating\navgPred.head()\n````\n\n````\nresult: \n\n\tuserId\tmovieId\trating\tpred\n9\t1\t1343\t2.0\t3.542115\n15\t1\t2193\t2.0\t3.542115\n18\t1\t2968\t1.0\t3.542115\n27\t2\t110\t4.0\t3.542115\n47\t2\t273\t4.0\t3.542115\n````\n\n## Test 데이터의 평점과 예측값 사이의 MAE, RMSE를 계산\n\n- 평점 예측 기준이 세분화되지 않아 에러가 크다.\n- rmse는 평점과 예측값 사이의 차이가 클수록 mae에 비해 에러값이 증가\n\n````python\navgPredErrors = avgPred['pred'] - avgPred['rating']\nmae = avgPredErrors.abs().mean()\nrmse = math.sqrt(avgPredErrors.pow(2).mean())\nprint(mae)\nprint(rmse)\n````\n\n````\nresult: \n\n0.8586874505577531\n1.0629409004509323\n````\n\n---\n\n# 사용자 ID별 영화 평균 평점으로 각각의 영화 평점 예측\n\n- 사용자의 평점 성향을 파악할 수 있다.\n\n## Train 데이터에서 사용자 ID별로 그룹 평균 계산\n\n- .groupby('userId').mean() === .groupby('userId').agg('mean')\n- agg는 그룹별로 결과를 얻는 조작을 Aggregation의 약자\n- .agg({'price': my_mean, 'quantity': np.sum}) 등으로 두 개 이상의 그룹 계산을 진행할 수 있다.\n\n````python\nuserAvgRatings = train[['userId', 'rating']].groupby('userId').agg('mean')\nuserAvgRatings.columns = ['pred']\nuserAvgRatings\n````\n\n````\nresult: \n\n1\t2.705882\n2\t3.485294\n3\t3.579545\n4\t4.351351\n5\t3.893617\n````\n\n## merge: left inner join\n\n- Test 데이터에 사용자별 예측 평점을 추가한다.\n- right_index: Use the index from the left DataFrame as the join key(s). \n- right_index는 default가 false이므로 표기할 필요 없다.\n\n````python\nuserAvgPred = test[['userId', 'movieId', 'rating']]\nuserAvgPred = pd.merge(userAvgPred, userAvgRatings, how='left', left_on=['userId'], right_on=['userId'], right_index = False)\nuserAvgPred.head()\n\n````\n\n````\nresult: \n\n\tuserId\tmovieId\trating\tpred\n0\t1\t1343\t2.0\t2.705882\n1\t1\t2193\t2.0\t2.705882\n2\t1\t2968\t1.0\t2.705882\n3\t2\t110\t4.0\t3.485294\n4\t2\t273\t4.0\t3.485294\n````\n\n## MAE, RMSE 계산\n\n- 사용자의 성향이 고려되어 에러 값이 낮아졌다.\n- MAE: 0.8586874505577531 -> 0.7581636860631077\n- RSME: 1.0629409004509323 -> 0.9652871605248908\n\n````python\nuserAvgPredErrors = userAvgPred['pred'] - userAvgPred['rating']\nmae2 = userAvgPredErrors.abs().mean()\nrmse2 = math.sqrt(userAvgPredErrors.pow(2).mean())\nprint(mae2)\nprint(rmse2)\n````\n\n````\nresult: \n\n0.7581636860631077\n0.9652871605248908\n````\n\n---\n\n# 영화별 평점 평균을 통한 영화 평점 예측\n\n## movieId 그룹별로 평균 계산\n\n````python\nitemAvgRatings = train[['movieId', 'rating']].groupby('movieId').agg('mean')\nitemAvgRatings.columns = ['pred'] # 'rating' 칼럼의 이름을 'pred'로 수정\nitemAvgRatings.head()\n\n````\n\n````\nresult: \n\n\tpred\nmovieId\t\n1\t3.870044\n2\t3.435644\n3\t3.200000\n4\t2.388889\n5\t3.294118\n````\n\n## merge\n\n````python\nitemAvgPred = test[['userId', 'movieId', 'rating']]\nitemAvgPred = pd.merge(itemAvgPred, itemAvgRatings, how='left', left_on=['movieId'], right_on=['movieId'], right_index = False)\nitemAvgPred.head()\n````\n\n````\nresult: \n\n  userId\tmovieId\trating\tpred\n0\t1\t1343\t2.0\t3.720588\n1\t1\t2193\t2.0\t3.166667\n2\t1\t2968\t1.0\t3.587500\n3\t2\t110\t4.0\t3.923858\n4\t2\t273\t4.0\t3.125000\n````\n\n## MAE, RMSE\n\n- 사용자 별로 평점을 예측 했을 때보다 에러가 조금 상승했다.\n\n````python\nitemAvgPredErrors = itemAvgPred['pred'] - itemAvgPred['rating']\nmae3 = itemAvgPredErrors.abs().mean()\nrmse3 = math.sqrt(itemAvgPredErrors.pow(2).mean())\nprint(mae3)\nprint(rmse3)\n````\n\n````\nresult: \n\n0.761464979636912\n0.974768257763819\n````\n\n---\n\n# URL을 주피터 노트북에서 이미지로 확인하기\n\n## 데이터 불러오기 \n````python\ndfMovie = pd.read_csv('movielens/movies_w_imgurl.csv')\ndfMovie.head()\n````\n\n````\nresult: \n\n\n  movieId\timdbId\ttitle\tgenres\timgurl\n0\t1\t114709\tToy Story (1995)\tAdventure|Animation|Children|Comedy|Fantasy\thttps://images-na.ssl-images-amazon.com/images...\n1\t2\t113497\tJumanji (1995)\tAdventure|Children|Fantasy\thttps://images-na.ssl-images-amazon.com/images...\n2\t3\t113228\tGrumpier Old Men (1995)\tComedy|Romance\thttps://images-na.ssl-images-amazon.com/images...\n3\t4\t114885\tWaiting to Exhale (1995)\tComedy|Drama|Romance\thttps://images-na.ssl-images-amazon.com/images...\n4\t5\t113041\tFather of the Bride Part II (1995)\tComedy\thttps://images-na.ssl-images-amazon.com/images...\n````\n\n## 주피터 노트북 셀 실행화면에 다음과 같이 이미지를 확인할 수 있다.\n\n````python\nfrom IPython.display import Image, display\n\nfor i in range(0, 5):\n    display(Image(dfMovie['imgurl'].iloc[i]))\n````\n\n````\nresult: \n````\n<img src=\"https://user-images.githubusercontent.com/46799722/140501330-31eaf555-3d63-4dba-910d-a065f680b14b.png\" style=\"width: 100%;\"/>\n"},{"id":1635951600,"title":"React HOC를 사용해보자","author":"jangky000","date":"2021.11.04","content":"\n# 상황 #1\n\n이번에 회사에서 React 프로젝트에 4개의 새로운 페이지를 추가하는 태스크를 맡게 되었다. \n\n아래와 같이 4개의 페이지를 제작해야 한다고 하자, 4개의 페이지에는 공통적으로 날짜를 선택할 수 있는 Calendar Selector가 있고, 이 셀렉터에는 사용자에 따라 **선택 가능한 기간**과 **기본 설정 기간** 정보가 필요하다.\n- **선택 가능한 기간**은 서버에서 데이터를 불러와 전역 상태로 관리되고 있는 데이터다.\n- **기본 설정 기간** 역시 전역 상태 데이터다.\n- 각각의 페이지는 Calendar Selector에서 선택한 기간에 따라 다른 데이터를 불러와 출력해야 한다.\n\n<div style=\"display: grid;grid-template-columns: repeat(2, 1fr);grid-column-gap: 20px;grid-row-gap: 20px;\">\n    <img src=\"https://user-images.githubusercontent.com/46799722/140294319-00c25762-be33-4452-93ad-b9ffec94b290.png\" style=\"width:100%;\"/>\n    <img src=\"https://user-images.githubusercontent.com/46799722/140294330-2092adfa-5527-4b24-a23b-2c75838e98f7.png\" style=\"width:100%;\"/>\n    <img src=\"https://user-images.githubusercontent.com/46799722/140294336-21ddcf01-228d-4ff0-b74c-4148139496cc.png\" style=\"width:100%;\"/>\n    <img src=\"https://user-images.githubusercontent.com/46799722/140294339-c4061391-c5a0-47ab-b619-4a34e8a11ec8.png\" style=\"width:100%;\"/>\n</div>\n\n# 코드의 재사용\n\n*전역 상태 관리 스토어에서 **선택 가능한 기간**과 **기본 설정 기간**을 가져와 데이터를 검증을 한 뒤 사용하고 싶다, 4개의 페이지에서 똑같이.*\n\n**선택 가능한 기간**과, **기본 설정 기간** 정도 데이터를 불러오는데, 이 로직을 재사용하겠다고 결심한 이유는 다음과 같다.\n\n- 유지 보수할 때, 복사 붙여넣기 되어 있는 4개의 소스를 하나씩 찾아 고치고 싶지 않다.\n- 각각의 페이지에서 최대한 데이터를 가공하는 로직을 제거하고, View를 그리는 역할에만 집중하고 싶다.\n\n# 리액트에서 코드를 재사용할 수 있는 방법\n\n- Util 성 순수 함수\n- Composition\n- Render Props\n- HOC\n- Custom Hook\n\n# 이중 HOC를 선택한 이유는 다음과 같다.\n\n- Util 성 순수함수는 전역 상태 관리 스토어 값을 활용 할 수 없다.(순수 함수 정의에 위배)\n- Composition은, Render Props는 JSX Element 형태로 사용하여 동적으로 무엇을 그릴지에 초점이 있는 느낌이다.\n- 하지만 내게 필요한 기능은 단순히 전역 상태 관리 스토어에서 데이터를 가져오는 기능이다.\n- <s>선택지가 아직 두 개가 남았지만 내게 가장 낯선 HOC를 사용해보고 싶었다.</s>\n\n# HOC(Higher Order Component): 고차함수\n\n> 고차 컴포넌트(HOC, Higher Order Component)는 컴포넌트 로직을 재사용하기 위한 React의 고급 기술이다. 고차 컴포넌트(HOC)는 React API의 일부가 아니며, React의 구성적 특성에서 나오는 패턴이다. ([참고](https://ko.reactjs.org/docs/higher-order-components.html))\n\n> *\"횡단 관심사(Cross-Cutting Concerns)에 고차 컴포넌트를 사용할 수 있다.\"*\n\n이 설명을 보고 JAVA의 AOP가 떠올랐다. 여러 컴포넌트에서 공통적으로 사용되는 로직을 횡단 관심사로 보아 하나로 묶어 관리할 수 있다고 한다.\n\n## HOC는\n\n- 리액트 컴포넌트를 인자로 받아서 다른 리액트 컴포넌트를 반환하는 함수\n- 컴포넌트에 특정 기능을 부여한다.\n- 특정한 기능을 수행한 후 인자로 받은 컴포넌트에 데이터를 넘겨줄 수도 있다.\n\n\n# 어떠한 경우에 HOC를 사용할까?\n\n- 로딩, 에러, 데이터 요청 등 여러 컴포넌트에서 반복적으로 사용되는 로직을 컴포넌트 바깥으로 분리할 때 고려될 수 있다.\n\n# Functional하게 HOC 사용하기\n\n- React 공식 홈페이지에서는 class 형태로 HOC를 사용하는 예제가 나와 있지만, 리액트 프로젝트에서 함수형 컴포넌트로 사용하고 있기 때문에, 함수의 형태로 HOC를 사용하는 방법을 조사했다.\n\n# 사용 예제\n\n````typescript\n// HOC 함수: withCalendarDateRange\nimport React, { FC, useMemo } from 'react';\nimport moment from 'moment';\nimport { useDataStore } from './context/Store';\nimport { DateRange } from './Calendar';\n\nexport interface CalendarDateRangeProps {\n  selectableDateRange: DateRange;\n  initSelectedDateRange: DateRange;\n}\n\ninterface WrapperProps extends CalendarDateRangeProps {\n  [props: string]: unknown;\n}\n\nexport const withCalendarDateRange = <OriginProps,>(WrappedComponent: FC<WrapperProps>): FC<OriginProps> => {\n  const WrapperComponent = (props?: OriginProps) => {\n    const { projectStore } = useDataStore();\n\n    const selectableDateRange = useMemo(() => {\n      const dateRange = projectStore.date.selectable\n      // 검증 로직...\n      return dateRange;\n    }, []);\n\n    const initSelectedDateRange = useMemo(() => {\n      const dateRange = projectStore.date.init\n      // 검증 로직...\n      return dateRange;\n    }, []);\n\n    return (\n      <WrappedComponent\n        {...props}\n        selectableDateRange={selectableDateRange}\n        initSelectedDateRange={initSelectedDateRange}\n      />\n    );\n  };\n  WrapperComponent.displayName = WrappedComponent.displayName || WrappedComponent.name || 'CalendarDateRangeWrapper';\n  return WrapperComponent;\n};\n````\n\n````typescript\n// 공통 로직을 추가할 컴포넌트: WrappedVisitStatus\n// Props를 통해 selectableDateRange, initSelectedDateRange 데이터를 받는다.\nimport React, { useState } from 'react';\nimport { Calendar, DateRange } from './Calendar';\nimport { withCalendarDateRange, CalendarDateRangeProps } from './HOC/withCalendarDateRange';\n\ntype WrappedVisitStatusProps = CalendarDateRangeProps;\n\nconst WrappedVisitStatus = ({ selectableDateRange, initSelectedDateRange }: WrappedVisitStatusProps) => {\n  const [dateRange, setDateRange] = useState<DateRange>();\n  const handleDateRange = (changedDateRange: DateRange) => setDateRange(changedDateRange);\n\n  return (\n    <StyledLayout>\n      <StyledTitleWrapper>\n        <StyledTitle>방문 현황</StyledTitle>\n        <Calendar\n          selectableRange={selectableDateRange}\n          initDateRange={initSelectedDateRange}\n          dateHandle={handleDateRange}\n        />\n      </StyledTitleWrapper>\n    </StyledLayout>\n  );\n};\n\n// HOC를 통해 캘린더 데이터 Props 삽입\nexport const VisitStatus = withCalendarDateRange(WrappedVisitStatus);\n````\n\n````typescript\n// 공통 로직이 추가된 컴포넌트 사용: Dashboard\nimport React, { FC, useState } from 'react';\nimport { BGTab, ITab } from './components/BGTab';\nimport { TopNavBar } from './components/TopNavBar';\nimport { Container } from './Dashboard.style';\nimport { tabList } from './Dashboard.data';\nimport { BorderSection } from './components/BorderSection';\nimport { VisitStatus } from './components/VisitStatus';\n\ninterface IUseTab {\n  selectedTab: ITab;\n  handleTab: (tab: ITab) => void;\n}\nexport const useTab = (defaultTab: ITab): IUseTab => {\n  const [selectedTab, setTab] = useState<ITab>(defaultTab);\n  const handleTab = (tab: ITab) => {\n    setTab(tab);\n  };\n  return { selectedTab, handleTab };\n};\n\nexport const Dashboard: FC = () => {\n  const { selectedTab, handleTab } = useTab(tabList[0]);\n\n  return (\n    <Container>\n      <TopNavBar title=\"CRM 대시보드\" style={{ border: 0 }} />\n      <BGTab tabList={tabList} selectedTab={selectedTab} handleTab={handleTab} />\n      <BorderSection style={{ marginTop: '32px', borderRadius: '8px' }}>\n        {selectedTab.key === 'visitStatus' && <VisitStatus />}\n      </BorderSection>\n    </Container>\n  );\n};\n\n````\n\n# 좀 더 간단한 코드\n\n````javascript\n// HOC\nexport const withHOC = WrappedComponent => {\n  const NewComponent = async (props) => {\n    // 공통 로직\n    const { newData } = await fetchNewDate(); // newData = 'Higher Order Component'\n    return (\n        <WrappedComponent {...props} data={newData} />\n      );\n  }\n  NewComponent.displayName = 'NewComponent'\n  return NewComponent;\n}\n````\n\n````javascript\n// 공통 로직을 추가할 컴포넌트\nimport { withHOC } from 'withHOC.tsx'\nconst WrappedComponent = ({text, data})=>{\n    // name은 PageComponent에서 props로 넘겨준 데이터\n    // data는 HOC에 의해 props에 추가된\n    return (\n        <div>\n            <div>{text}</div>\n            <div>{data}</div>\n        </div>\n    );\n}\nexport const MyComponent = withHOC(WrappedComponent)\n````\n\n````javascript\nimport { MyComponent } from 'MyComponent.tsx'\n// 공통 로직이 추가된 컴포넌트 사용\nconst PageComponent에서 = ()=>{\n    return <MyComponent text={'HOC'}/>\n}\n````\n````\n결과 화면:\n\nHOC\nHigher Order Component\n````\n\n# 그런데,\n\n어찌저찌 HOC를 사용해보고 싶은 지적인 욕심은 풀었으나 HOC의 단점들이 눈에 들어오기 시작했다.\n\n- 타입스크립트를 사용한다면, 타입을 맞추기도 어려울 뿐더러, 읽기도 어렵다.\n\n````typescript\nexport interface CalendarDateRangeProps {\n  selectableDateRange: DateRange;\n  initSelectedDateRange: DateRange;\n}\n\ninterface WrapperProps extends CalendarDateRangeProps {\n  [props: string]: unknown;\n}\n\nexport const withCalendarDateRange = <OriginProps,>(WrappedComponent: FC<WrapperProps>): FC<OriginProps> => {\n  const WrapperComponent = (props?: OriginProps) => {\n    ...\n````\n\n- 여러 HOC를 하나의 컴포넌트에서 사용해야 할 경우가 생긴다면, `withA(withB(withC(MyComponent)))` 처럼 함수 호출 Depth가 깊어진다(Nesting).\n\n# 나는 평소 Hooks를 소중히 여기지 않았지\n\n필자는 리액트를 처음 시작할 때부터 함수형 컴포넌트와 리액트 Hooks를 사용해왔기 때문에 Hooks의 편리함을 잘 몰랐다. [리액트 Hooks는 대부분의 HOC와 Render Props를 대체 가능하며, 더 간단하고 리액트 가상 DOM Tree의 Nesting을 줄여준다.](https://reactjs.org/docs/hooks-faq.html#do-hooks-replace-render-props-and-higher-order-components)\n다음과 같이 Custom Hook을 사용하여 해결이 가능하다.\n\n````typescript\n// useCalendarDateRange.ts\nconst useCalendarDateRange = ()=>{\n  const { projectStore } = useDataStore();\n\n    const selectableDateRange = useMemo(() => {\n      const dateRange = projectStore.date.selectable\n      // 검증 로직...\n      return dateRange;\n    }, []);\n\n    const initSelectedDateRange = useMemo(() => {\n      const dateRange = projectStore.date.init\n      // 검증 로직...\n      return dateRange;\n    }, []);\n  return {selectableDateRange, initSelectedDateRange}\n}\n````\n\n````typescript\n// 공통 로직을 추가할 컴포넌트: VisitStatus\n// Props를 통해서가 아닌 useCalendarDateRange()를 호출해서 필요한 데이터를 받는다.\nimport React, { useState } from 'react';\nimport { Calendar, DateRange } from './Calendar';\nimport { useCalendarDateRange } from './hooks/useCalendarDateRange';\n\nexport const VisitStatus = () => {\n  const [dateRange, setDateRange] = useState<DateRange>();\n  const handleDateRange = (changedDateRange: DateRange) => setDateRange(changedDateRange);\n  const {selectableDateRange, initSelectedDateRange} = useCalendarDateRange();\n\n  return (\n    <StyledLayout>\n      <StyledTitleWrapper>\n        <StyledTitle>방문 현황</StyledTitle>\n        <Calendar\n          selectableRange={selectableDateRange}\n          initDateRange={initSelectedDateRange}\n          dateHandle={handleDateRange}\n        />\n      </StyledTitleWrapper>\n    </StyledLayout>\n  );\n};\n````\n\n# 결론\n\n- HOC는 함수형 컴포넌트와 리액트 Hooks가 나오기 이전부터 Class Component 개발에서 리액트 Life Cycle에 종속적이지 않은 중복된 코드를 분리하기 위해서 사용되었다. (그래서 공식 홈페이지에 클래스형 컴포넌트로 만들어진 HOC 예제가 있나보다.)\n- HOC는 클래스형, 그리고 함수형 모두에 적용할 수 있어, 레거시와 모던한 리액트 컴포넌트 사이에서 연결 다리처럼 재사용이 가능하다는 장점이 있다. \n- 현재는 리액트 Hooks를 사용해 Custom Hook을 만들어 HOC를 대부분 대체할 수 있으며, 이렇게 사용하는 것이 더 간단하고 직관적이다.\n- 그러니 다시 소스를 수정하러 가야겠다.\n\n# 참고\n- [https://ko.reactjs.org/docs/higher-order-components.html](https://ko.reactjs.org/docs/higher-order-components.html)\n- [https://reactjs.org/docs/hooks-faq.html#do-hooks-replace-render-props-and-higher-order-components](https://reactjs.org/docs/hooks-faq.html#do-hooks-replace-render-props-and-higher-order-components)\n- [https://velog.io/@yeonseo07/%EB%AA%A8%EB%8B%AC%EC%9D%84-%EB%A7%8C%EB%93%A4%EB%8B%A4-%EC%83%9D%EA%B8%B4-%EC%9D%BC](https://velog.io/@yeonseo07/%EB%AA%A8%EB%8B%AC%EC%9D%84-%EB%A7%8C%EB%93%A4%EB%8B%A4-%EC%83%9D%EA%B8%B4-%EC%9D%BC)\n- [https://yceffort.kr/2020/10/react-hooks-and-hocs](https://yceffort.kr/2020/10/react-hooks-and-hocs)"},{"id":1635778800,"title":"첫 게시글","author":"jangky000","date":"2021.11.02","content":"\nNextJS 프레임워크로 만든 Markdown 블로그입니다."}]